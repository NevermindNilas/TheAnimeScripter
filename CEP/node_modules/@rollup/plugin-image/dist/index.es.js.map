{"version":3,"file":"index.es.js","sources":["../src/index.js"],"sourcesContent":["import { readFileSync } from 'fs';\nimport { extname } from 'path';\n\nimport { createFilter } from '@rollup/pluginutils';\nimport svgToMiniDataURI from 'mini-svg-data-uri';\n\nconst defaults = {\n  dom: false,\n  exclude: null,\n  include: null\n};\n\nconst mimeTypes = {\n  '.jpg': 'image/jpeg',\n  '.jpeg': 'image/jpeg',\n  '.png': 'image/png',\n  '.gif': 'image/gif',\n  '.svg': 'image/svg+xml',\n  '.webp': 'image/webp'\n};\n\nconst domTemplate = ({ dataUri }) => `\n  var img = new Image();\n  img.src = \"${dataUri}\";\n  export default img;\n`;\n\nconst constTemplate = ({ dataUri }) => `\n  var img = \"${dataUri}\";\n  export default img;\n`;\n\nconst getDataUri = ({ format, isSvg, mime, source }) =>\n  isSvg ? svgToMiniDataURI(source) : `data:${mime};${format},${source}`;\n\nexport default function image(opts = {}) {\n  const options = Object.assign({}, defaults, opts);\n  const filter = createFilter(options.include, options.exclude);\n\n  return {\n    name: 'image',\n\n    load(id) {\n      if (!filter(id)) {\n        return null;\n      }\n\n      const mime = mimeTypes[extname(id)];\n      if (!mime) {\n        // not an image\n        return null;\n      }\n\n      const isSvg = mime === mimeTypes['.svg'];\n      const format = isSvg ? 'utf-8' : 'base64';\n      const source = readFileSync(id, format).replace(/[\\r\\n]+/gm, '');\n      const dataUri = getDataUri({ format, isSvg, mime, source });\n      const code = options.dom ? domTemplate({ dataUri }) : constTemplate({ dataUri });\n\n      return code.trim();\n    }\n  };\n}\n"],"names":["const"],"mappings":";;;;;AAMAA,IAAM,QAAQ,GAAG;AACjB,EAAE,GAAG,EAAE,KAAK;AACZ,EAAE,OAAO,EAAE,IAAI;AACf,EAAE,OAAO,EAAE,IAAI;AACf,CAAC,CAAC;AACF;AACAA,IAAM,SAAS,GAAG;AAClB,EAAE,MAAM,EAAE,YAAY;AACtB,EAAE,OAAO,EAAE,YAAY;AACvB,EAAE,MAAM,EAAE,WAAW;AACrB,EAAE,MAAM,EAAE,WAAW;AACrB,EAAE,MAAM,EAAE,eAAe;AACzB,EAAE,OAAO,EAAE,YAAY;AACvB,CAAC,CAAC;AACF;AACAA,IAAM,WAAW,gBAAe;;;yDAEjB,OAAO;CAErB,CAAC;AACF;AACAA,IAAM,aAAa,gBAAe;;;+BACnB,OAAO;CAErB,CAAC;AACF;AACAA,IAAM,UAAU,gBAAmC;4BAArB;0BAAO;wBAAM;;;WACzC,KAAK,GAAG,gBAAgB,CAAC,MAAM,CAAC,cAAW,IAAI,SAAI,MAAM,SAAI;CAAQ,CAAC;AACxE;AACe,SAAS,KAAK,CAAC,IAAS,EAAE;6BAAP,GAAG;AAAK;AAC1C,EAAEA,IAAM,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;AACpD,EAAEA,IAAM,MAAM,GAAG,YAAY,CAAC,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;AAChE;AACA,EAAE,OAAO;AACT,IAAI,IAAI,EAAE,OAAO;AACjB;AACA,IAAI,mBAAI,CAAC,EAAE,EAAE;AACb,MAAM,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE;AACvB,QAAQ,OAAO,IAAI,CAAC;AACpB,OAAO;AACP;AACA,MAAMA,IAAM,IAAI,GAAG,SAAS,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;AAC1C,MAAM,IAAI,CAAC,IAAI,EAAE;AACjB;AACA,QAAQ,OAAO,IAAI,CAAC;AACpB,OAAO;AACP;AACA,MAAMA,IAAM,KAAK,GAAG,IAAI,KAAK,SAAS,CAAC,MAAM,CAAC,CAAC;AAC/C,MAAMA,IAAM,MAAM,GAAG,KAAK,GAAG,OAAO,GAAG,QAAQ,CAAC;AAChD,MAAMA,IAAM,MAAM,GAAG,YAAY,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC,OAAO,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;AACvE,MAAMA,IAAM,OAAO,GAAG,UAAU,CAAC,UAAE,MAAM,SAAE,KAAK,QAAE,IAAI,UAAE,MAAM,EAAE,CAAC,CAAC;AAClE,MAAMA,IAAM,IAAI,GAAG,OAAO,CAAC,GAAG,GAAG,WAAW,CAAC,WAAE,OAAO,EAAE,CAAC,GAAG,aAAa,CAAC,WAAE,OAAO,EAAE,CAAC,CAAC;AACvF;AACA,MAAM,OAAO,IAAI,CAAC,IAAI,EAAE,CAAC;AACzB,KAAK;AACL,GAAG,CAAC;AACJ;;;;"}